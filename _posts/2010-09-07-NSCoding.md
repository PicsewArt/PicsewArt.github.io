---
title: "NSCoding Tutorial for iOS: How To Save Your App Data"
category: "iOS"
copy: true
tags: [iOS, NSCoding]
cave: true
hero:
  format: 'jpeg'
  url: 'HERO_0038.jpg'
---
<div class="content-wrapper">
    <div id="attachment_1915" style="width: 260px" class="wp-caption alignright">
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/saveddoc" rel="attachment wp-att-1915" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/SavedDoc.jpg" alt="This bug doesn't look so scary on disk!" title="This bug doesn't look so scary on disk!" width="250" height="165" class="size-full wp-image-1915" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/SavedDoc.jpg 250w, https://koenig-media.raywenderlich.com/uploads/2010/08/SavedDoc-150x99.jpg 150w"
                sizes="(max-width: 250px) 100vw, 250px"></a>
        <p class="wp-caption-text">This bug doesn't look so scary on disk!</p>
    </div>
    <p>There are many different ways to save your data to disk in iOS – raw file APIs, Property List Serialization, SQLite, Core Data, and of course NSCoding.</p>
    <p>For apps with heavy data requirements, Core Data is often the best way to go. </p>
    <p>However, for apps with light data requirements, NSCoding with NSFileManager can be a nice way to go because it’s such a simple alternative.</p>
    <p>In this NSCoding tutorial, we’re going to take the “Scary Bugs” app that we’ve been working on in a simple project and extend it so that it saves the app’s data to disk.</p>
    <p>Along the way, we’ll cover how you can use NSCoding to persist your normal app data, and use NSFileManager to store large files for efficiency.</p>
    <h2>Implementing NSCoding</h2>
    <p>NSCoding is a protcol that you can implement on your data classes to support encoding and decoding your data into a data buffer, which can then be persisted to disk.</p>
    <p>Implementing NSCoding is actually ridiculously easy – that’s why I find it so helpful to use sometimes. Watch how quickly we can bang this out!</p>
    <p>First make the following mod to ScaryBugData.h:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19141">
                    <td class="code" id="p1914code1"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Modify @interface line to include the NSCoding protocol</span>
<span style="color: #a61390;">@interface</span> ScaryBugData <span style="color: #002200;">:</span> <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/" sl-processed="1"><span style="color: #400080;">NSObject</span></a> &lt;NSCoding&gt; <span style="color: #002200;">{</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Then add the following to the bottom of ScaryBugData.m:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19142">
                    <td class="code" id="p1914code2"><pre class="objc" style="font-family:monospace;"><span style="color: #6e371a;">#pragma mark NSCoding</span>
&nbsp;
<span style="color: #6e371a;">#define kTitleKey       @"Title"</span>
<span style="color: #6e371a;">#define kRatingKey      @"Rating"</span>
&nbsp;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span> encodeWithCoder<span style="color: #002200;">:</span><span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSCoder_Class/" sl-processed="1"><span style="color: #400080;">NSCoder</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>encoder <span style="color: #002200;">{</span>
    <span style="color: #002200;">[</span>encoder encodeObject<span style="color: #002200;">:</span>_title forKey<span style="color: #002200;">:</span>kTitleKey<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>encoder encodeFloat<span style="color: #002200;">:</span>_rating forKey<span style="color: #002200;">:</span>kRatingKey<span style="color: #002200;">]</span>;
<span style="color: #002200;">}</span>
&nbsp;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">id</span><span style="color: #002200;">)</span>initWithCoder<span style="color: #002200;">:</span><span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSCoder_Class/" sl-processed="1"><span style="color: #400080;">NSCoder</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>decoder <span style="color: #002200;">{</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>title <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>decoder decodeObjectForKey<span style="color: #002200;">:</span>kTitleKey<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">float</span> rating <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>decoder decodeFloatForKey<span style="color: #002200;">:</span>kRatingKey<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">return</span> <span style="color: #002200;">[</span>self initWithTitle<span style="color: #002200;">:</span>title rating<span style="color: #002200;">:</span>rating<span style="color: #002200;">]</span>;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>That’s it! Note that we have to implement two methods: encodeWithCoder, and initWithEncoder. I like to think of encodeWithCoder as “encode”, and initWithCoder as “decode”.</p>
    <p>In encodeWithCoder, we’re passed in a NSCoder object, and we can call helper methods on it to encode various pieces of data. It has methods such as encodeObject, encodeFloat, encodeInt, etc. Each time we encode something, we provide a key that we
        can use to decode the object in initWithCoder later.</p>
    <p>The nice thing about the way NSCoder is set up is that it makes it easy to modify your objects over time as you release new versions of your app and still be able to support older files. </p>
    <p>One of the most common things you’ll do in your apps is add new fields to your objects. When you have a new field, you can encode it in encodeWithCoder, and in decodeWithCoder you can try decoding it, but check if it’s nil (for objects) or 0 (for
        numerics), which means “that key was not found”. And if it’s not found, you can provide a default value.</p>
    <p>If 0 or nil are actually valid values, you can also take the approach of serializing a version number along with your data and use that to understand what should be there or not (in fact that’s the approach I usually take).</p>
    <p>If you want to read up more on NSCoding, I recommend this great <a href="https://www.mikeash.com/pyblog/friday-qa-2010-08-12-implementing-nscoding.html" sl-processed="1">article by Mike Ash</a> on implementing NSCoding.</p>
    <h2>Loading and Saving To Disk</h2>
    <p>We’ve implemented the code to encode and decode our data, but we still need some code to load and save that to disk.</p>
    <p>We’re going to approach this by adding a new initializer to our ScaryBugDoc that takes a directory name to look in for data to load. However for efficiency purposes we won’t load the data in right away – we will load it the first time it’s accessed,
        by implementing the “get data” method.</p>
    <p>We’ll also provide a method that we can call to save the document back out to disk, a method to delete the document, and an initializer that doesn’t take a document path at all, for the case where we are making a new file so will need a new directory
        to save the file in.</p>
    <p>You may wonder why we’re taking a directory path as an argument rather than just a single file path. This is because we’re going to eventually have three pieces of data we’re saving in this directory – the encoded ScaryBugData, the thumbnail image,
        and the full image. We’ll cover why we’re taking this approach and how to save the images out later on.</p>
    <p>Ok so let’s do this! Make the following changes to ScaryBugDoc.h:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19143">
                    <td class="code" id="p1914code3"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Inside @interface</span>
<a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>_docPath;
&nbsp;
<span style="color: #11740a; font-style: italic;">// After @interface</span>
<span style="color: #a61390;">@property</span> <span style="color: #002200;">(</span>copy<span style="color: #002200;">)</span> <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>docPath;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">id</span><span style="color: #002200;">)</span>init;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">id</span><span style="color: #002200;">)</span>initWithDocPath<span style="color: #002200;">:</span><span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>docPath;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>saveData;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>deleteDoc;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Next we need to make some changes to ScaryBugDoc.m. There’s several bits here that we need to discuss, so let’s go over it bit by bit.</p>
    <p><em>1) Add initializer and bookkeeping code</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19144">
                    <td class="code" id="p1914code4"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// At top of file</span>
<span style="color: #6e371a;">#import "ScaryBugDatabase.h"</span>
<span style="color: #6e371a;">#define kDataKey        @"Data"</span>
<span style="color: #6e371a;">#define kDataFile       @"data.plist"</span>
&nbsp;
<span style="color: #11740a; font-style: italic;">// After @implementation</span>
<span style="color: #a61390;">@synthesize</span> docPath <span style="color: #002200;">=</span> _docPath;
&nbsp;
<span style="color: #11740a; font-style: italic;">// Add to dealloc</span>
<span style="color: #002200;">[</span>_docPath release<span style="color: #002200;">]</span>;
_docPath <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;
&nbsp;
<span style="color: #11740a; font-style: italic;">// Add new methods</span>
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">id</span><span style="color: #002200;">)</span>init <span style="color: #002200;">{</span>
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">(</span>self <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>super init<span style="color: #002200;">]</span><span style="color: #002200;">)</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
    <span style="color: #002200;">}</span>
    <span style="color: #a61390;">return</span> self;
<span style="color: #002200;">}</span>
&nbsp;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">id</span><span style="color: #002200;">)</span>initWithDocPath<span style="color: #002200;">:</span><span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>docPath <span style="color: #002200;">{</span>
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">(</span>self <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>super init<span style="color: #002200;">]</span><span style="color: #002200;">)</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        _docPath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>docPath copy<span style="color: #002200;">]</span>;
    <span style="color: #002200;">}</span>
    <span style="color: #a61390;">return</span> self;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>First, we include a file we haven’t written yet – ScaryBugDatabase.h. We’ll be writing that next, so don’t worry about it for now.</p>
    <p>Next we make some definitions for the key we’re going to save out data out to and the filename, which we’ll use a bit later.</p>
    <p>We synthesize our new property and remember to release it in dealloc.</p>
    <p>Finally, we write our two new initializers. Regular init does just about nothing, and initWithDocPath sets our docPath instance variable based on the value passed in. </p>
    <p>Note that for both init and initWithTitle, docPath will be nil. When docPath is nil, that means to us that this document hasn’t been saved to disk yet, so when we save we’ll need to find a new location to save it in.</p>
    <p><em>2)Write helper function to create document path</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19145">
                    <td class="code" id="p1914code5"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">BOOL</span><span style="color: #002200;">)</span>createDataPath <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_docPath <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        self.docPath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>ScaryBugDatabase nextScaryBugDocPath<span style="color: #002200;">]</span>;
    <span style="color: #002200;">}</span>
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/" sl-processed="1"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;
    <span style="color: #a61390;">BOOL</span> success <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/" sl-processed="1"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">]</span> createDirectoryAtPath<span style="color: #002200;">:</span>_docPath withIntermediateDirectories<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span> attributes<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span> error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">!</span>success<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        NSLog<span style="color: #002200;">(</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Error creating data path: %@"</span>, <span style="color: #002200;">[</span>error localizedDescription<span style="color: #002200;">]</span><span style="color: #002200;">)</span>;
    <span style="color: #002200;">}</span>
    <span style="color: #a61390;">return</span> success;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>When we go to save our document, the first thing we’re going to want to do is create the directory to save it in if it doesn’t exist already.</p>
    <p>To find an unused directory, we’re going to use the ScaryBugDatabase helper class which we’ll write next to figure that out.</p>
    <p>Once we have an unused directory, we can use the createDirectoryAtPath method in NSFileManager to create it for us. It will return success if it creates the directory, or if it already exists.</p>
    <p><em>3) Override data property to load from disk</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19146">
                    <td class="code" id="p1914code6"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">-</span> <span style="color: #002200;">(</span>ScaryBugData <span style="color: #002200;">*</span><span style="color: #002200;">)</span>data <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_data <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span> _data;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>dataPath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kDataFile<span style="color: #002200;">]</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/" sl-processed="1"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>codedData <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/" sl-processed="1"><span style="color: #400080;">NSData</span></a> alloc<span style="color: #002200;">]</span> initWithContentsOfFile<span style="color: #002200;">:</span>dataPath<span style="color: #002200;">]</span> autorelease<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>codedData <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span> <span style="color: #a61390;">nil</span>;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedUnarchiver_Class/" sl-processed="1"><span style="color: #400080;">NSKeyedUnarchiver</span></a> <span style="color: #002200;">*</span>unarchiver <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedUnarchiver_Class/" sl-processed="1"><span style="color: #400080;">NSKeyedUnarchiver</span></a> alloc<span style="color: #002200;">]</span> initForReadingWithData<span style="color: #002200;">:</span>codedData<span style="color: #002200;">]</span>;
    _data <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span>unarchiver decodeObjectForKey<span style="color: #002200;">:</span>kDataKey<span style="color: #002200;">]</span> retain<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>unarchiver finishDecoding<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>unarchiver release<span style="color: #002200;">]</span>;
&nbsp;
    <span style="color: #a61390;">return</span> _data;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>When someone tries to access the data property, we’re going to check if we have it loaded into memory – and if so go ahead and return it. But if not, we’ll load it from disk!</p>
    <p>The first thing we do is create the full path to the file by appending the kDataFile constant (from the top of our file – “data.plist”) to our directory name, and then loading the data from disk with NSData’s initWithContentsOfFile method.</p>
    <p>Next we need to unserialize the data. The way you do that is by using the NSKeyedArchiver class, passing in the NSData buffer, and then call decodeObjectForKey. Behind the scenes, it will detect that the data buffer contains your ScaryBugDoc, call
        the initWithCoder method on that to initialize the class, and return you the new object.</p>
    <p><em>4) Add method to save to disk</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19147">
                    <td class="code" id="p1914code7"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>saveData <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_data <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span>;
&nbsp;
    <span style="color: #002200;">[</span>self createDataPath<span style="color: #002200;">]</span>;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>dataPath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kDataFile<span style="color: #002200;">]</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableData_Class/" sl-processed="1"><span style="color: #400080;">NSMutableData</span></a> <span style="color: #002200;">*</span>data <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableData_Class/" sl-processed="1"><span style="color: #400080;">NSMutableData</span></a> alloc<span style="color: #002200;">]</span> init<span style="color: #002200;">]</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedArchiver_Class/" sl-processed="1"><span style="color: #400080;">NSKeyedArchiver</span></a> <span style="color: #002200;">*</span>archiver <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSKeyedArchiver_Class/" sl-processed="1"><span style="color: #400080;">NSKeyedArchiver</span></a> alloc<span style="color: #002200;">]</span> initForWritingWithMutableData<span style="color: #002200;">:</span>data<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>archiver encodeObject<span style="color: #002200;">:</span>_data forKey<span style="color: #002200;">:</span>kDataKey<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>archiver finishEncoding<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>data writeToFile<span style="color: #002200;">:</span>dataPath atomically<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span><span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>archiver release<span style="color: #002200;">]</span>;
    <span style="color: #002200;">[</span>data release<span style="color: #002200;">]</span>;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>In saveData we do the reverse of the above. First we call our createDataPath method to create the directory if it doesn’t already exist, then we serialize the data with NSKeyedArchiver and write it out to disk.</p>
    <p><em>5) Add method to delete doc</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19148">
                    <td class="code" id="p1914code8"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>deleteDoc <span style="color: #002200;">{</span>
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/" sl-processed="1"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;
    <span style="color: #a61390;">BOOL</span> success <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/" sl-processed="1"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">]</span> removeItemAtPath<span style="color: #002200;">:</span>_docPath error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">!</span>success<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        NSLog<span style="color: #002200;">(</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Error removing document path: %@"</span>, error.localizedDescription<span style="color: #002200;">)</span>;
    <span style="color: #002200;">}</span>
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Last more thing to add. Now that we’re actually saving data out to disk, if the user deletes a bug from the table view, we’ll also need to delete the data from the disk, so we need a method for that:</p>
    <p>Very simple stuff here – just a call to removeItemAtPath, which will remove the entire directory plus its contents.</p>
    <p>Ok we’re getting pretty close! We’re just missing two pieces now: the ScaryBugDatabase object, and integration into the rest of our app.</p>
    <h2>Scary Bug Database</h2>
    <p>We’ve already seen one thing we need the Scary Bug Database object to do – figure out an available directory name for a new bug document.</p>
    <p>But there’s one other thing we need it to do too – figure out what bug document directories are there on startup, and loop through creating ScaryBugDocs and calling initWithDocPath for each.</p>
    <p>So let’s put these together! Right click on Model, go to “Add\New File…”, and add a new Cocoa Touch Class\Objective-C class\Subclass of NSObject. Name the new file ScaryBugDatabase.m, and click Finish.</p>
    <p>Then make the following mod to ScaryBugDatabase.h:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p19149">
                    <td class="code" id="p1914code9"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Add to bottom of file</span>
<span style="color: #002200;">+</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/" sl-processed="1"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>loadScaryBugDocs;
<span style="color: #002200;">+</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>nextScaryBugDocPath;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>So we’re just creating two static methods – one to load the scary bug documents (and return them in a NSMutableArray), and the one we were using earlier to get the next available path.</p>
    <p>Now let’s implement these, bit by bit.</p>
    <p><em>1) Write helper function to get document root</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191410">
                    <td class="code" id="p1914code10"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Add to top of file</span>
<span style="color: #6e371a;">#import "ScaryBugDoc.h"</span>
&nbsp;
<span style="color: #11740a; font-style: italic;">// After @implementation, add new function</span>
<span style="color: #002200;">+</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>getPrivateDocsDir <span style="color: #002200;">{</span>
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/" sl-processed="1"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>paths <span style="color: #002200;">=</span> NSSearchPathForDirectoriesInDomains<span style="color: #002200;">(</span>NSLibraryDirectory, NSUserDomainMask, <span style="color: #a61390;">YES</span><span style="color: #002200;">)</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>documentsDirectory <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>paths objectAtIndex<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">]</span>;
    documentsDirectory <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>documentsDirectory stringByAppendingPathComponent<span style="color: #002200;">:</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Private Documents"</span><span style="color: #002200;">]</span>;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/" sl-processed="1"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;
    <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/" sl-processed="1"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">]</span> createDirectoryAtPath<span style="color: #002200;">:</span>documentsDirectory withIntermediateDirectories<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span> attributes<span style="color: #002200;">:</span><span style="color: #a61390;">nil</span> error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">]</span>;
&nbsp;
    <span style="color: #a61390;">return</span> documentsDirectory;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>The other two functions are going to need a function to tell them where to save the bug documents subdirectories.</p>
    <p>One of the most common places to save data for your apps is in the “Documents” directory for your app. You can get the path to this with NSSearchPathForDirectoriesInDomains, passing in NSDocumentDirectory as the value.</p>
    <p>However, we don’t want to save here because in the next tutorial in our series, we’re going to extend this app even further to support the new File Sharing feature on iOS 4 and the iPad. The way file sharing works is it shows anything you save in
        the documents directory to the user, but for reasons we’ll get into later we don’t want the user seeing these directories as-is. According to an Apple doc on <a href="https://developer.apple.com/iphone/library/qa/qa2010/qa1699.html" sl-processed="1">Storing Private Data</a>,
        the recommended solution is to save your app’s data in a subdirectory of Library, so that’s what we’re doing here.</p>
    <p>So – we construct the path (which will be
        <application_home>/Library/Private Documents), and then create the directory if it doesn’t exist, returning the new path.</application_home>
    </p>
    <p><em>2) Write helper function to load all existing documents</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191411">
                    <td class="code" id="p1914code11"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">+</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/" sl-processed="1"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>loadScaryBugDocs <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Get private docs dir</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>documentsDirectory <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>ScaryBugDatabase getPrivateDocsDir<span style="color: #002200;">]</span>;
    NSLog<span style="color: #002200;">(</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Loading bugs from %@"</span>, documentsDirectory<span style="color: #002200;">)</span>;
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Get contents of documents directory</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/" sl-processed="1"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/" sl-processed="1"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>files <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/" sl-processed="1"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">]</span> contentsOfDirectoryAtPath<span style="color: #002200;">:</span>documentsDirectory error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>files <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        NSLog<span style="color: #002200;">(</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Error reading contents of documents directory: %@"</span>, <span style="color: #002200;">[</span>error localizedDescription<span style="color: #002200;">]</span><span style="color: #002200;">)</span>;
        <span style="color: #a61390;">return</span> <span style="color: #a61390;">nil</span>;
    <span style="color: #002200;">}</span>
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Create ScaryBugDoc for each file</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/" sl-processed="1"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span>retval <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/" sl-processed="1"><span style="color: #400080;">NSMutableArray</span></a> arrayWithCapacity<span style="color: #002200;">:</span>files.count<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">for</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>file <span style="color: #a61390;">in</span> files<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">[</span>file.pathExtension compare<span style="color: #002200;">:</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"scarybug"</span> options<span style="color: #002200;">:</span>NSCaseInsensitiveSearch<span style="color: #002200;">]</span> <span style="color: #002200;">==</span> NSOrderedSame<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
            <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>fullPath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>documentsDirectory stringByAppendingPathComponent<span style="color: #002200;">:</span>file<span style="color: #002200;">]</span>;
            ScaryBugDoc <span style="color: #002200;">*</span>doc <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><span style="color: #002200;">[</span>ScaryBugDoc alloc<span style="color: #002200;">]</span> initWithDocPath<span style="color: #002200;">:</span>fullPath<span style="color: #002200;">]</span> autorelease<span style="color: #002200;">]</span>;
            <span style="color: #002200;">[</span>retval addObject<span style="color: #002200;">:</span>doc<span style="color: #002200;">]</span>;
        <span style="color: #002200;">}</span>
    <span style="color: #002200;">}</span>
&nbsp;
    <span style="color: #a61390;">return</span> retval;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Here we get our documents directory, and use contentsOfDirectoryAtPath to get a list of files/directories inside. We loop through them all, looking for files/directories ending with the “scarybug” extension, which we’re using to represent a directory
        with our scary bug data. When we find them, we construct the full path, then create a ScaryBugDoc with the initWithDocPath initializer and add it to our list.</p>
    <p> <em>3) Write helper function to get next available document path</em></p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191412">
                    <td class="code" id="p1914code12"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">+</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span><span style="color: #002200;">)</span>nextScaryBugDocPath <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Get private docs dir</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>documentsDirectory <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>ScaryBugDatabase getPrivateDocsDir<span style="color: #002200;">]</span>;
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Get contents of documents directory</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSError_Class/" sl-processed="1"><span style="color: #400080;">NSError</span></a> <span style="color: #002200;">*</span>error;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/" sl-processed="1"><span style="color: #400080;">NSArray</span></a> <span style="color: #002200;">*</span>files <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSFileManager_Class/" sl-processed="1"><span style="color: #400080;">NSFileManager</span></a> defaultManager<span style="color: #002200;">]</span> contentsOfDirectoryAtPath<span style="color: #002200;">:</span>documentsDirectory error<span style="color: #002200;">:&amp;</span>error<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>files <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        NSLog<span style="color: #002200;">(</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"Error reading contents of documents directory: %@"</span>, <span style="color: #002200;">[</span>error localizedDescription<span style="color: #002200;">]</span><span style="color: #002200;">)</span>;
        <span style="color: #a61390;">return</span> <span style="color: #a61390;">nil</span>;
    <span style="color: #002200;">}</span>
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Search for an available name</span>
    <span style="color: #a61390;">int</span> maxNumber <span style="color: #002200;">=</span> <span style="color: #2400d9;">0</span>;
    <span style="color: #a61390;">for</span> <span style="color: #002200;">(</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>file <span style="color: #a61390;">in</span> files<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
        <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span><span style="color: #002200;">[</span>file.pathExtension compare<span style="color: #002200;">:</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"scarybug"</span> options<span style="color: #002200;">:</span>NSCaseInsensitiveSearch<span style="color: #002200;">]</span> <span style="color: #002200;">==</span> NSOrderedSame<span style="color: #002200;">)</span> <span style="color: #002200;">{</span>
            <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>fileName <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>file stringByDeletingPathExtension<span style="color: #002200;">]</span>;
            maxNumber <span style="color: #002200;">=</span> MAX<span style="color: #002200;">(</span>maxNumber, fileName.intValue<span style="color: #002200;">)</span>;
        <span style="color: #002200;">}</span>
    <span style="color: #002200;">}</span>
&nbsp;
    <span style="color: #11740a; font-style: italic;">// Get available name</span>
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>availableName <span style="color: #002200;">=</span> <span style="color: #002200;">[</span><a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> stringWithFormat<span style="color: #002200;">:</span><span style="color: #11740a; font-style: italic;">@</span><span style="color: #bf1d1a;">"%d.scarybug"</span>, maxNumber<span style="color: #002200;">+</span><span style="color: #2400d9;">1</span><span style="color: #002200;">]</span>;
    <span style="color: #a61390;">return</span> <span style="color: #002200;">[</span>documentsDirectory stringByAppendingPathComponent<span style="color: #002200;">:</span>availableName<span style="color: #002200;">]</span>;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Here we basically loop through our documents directory looking for “scarybug” directories, which should be in the format “#.scarybug”. We loop through to find the max number we currently have, and then return just one more than that number. That’s
        just one easy way to get a unique name for us to use.</p>
    <p>Ok we’re almost done! All we need to do now is integrate this with the rest of the app and try it out!</p>
    <h2>Try it Out!</h2>
    <p>This is pretty easy. Open up ScaryBugsAppDelegate.m and make the following changes:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191413">
                    <td class="code" id="p1914code13"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Add to top of file</span>
<span style="color: #6e371a;">#import "ScaryBugDatabase.h"</span>
&nbsp;
<span style="color: #11740a; font-style: italic;">// Comment out the code to load the sample ScaryBugDoc data in the beginning of application:didFinishLaunchingWithOptions, and replace it with the following:</span>
<a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/" sl-processed="1"><span style="color: #400080;">NSMutableArray</span></a> <span style="color: #002200;">*</span>loadedBugs <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>ScaryBugDatabase loadScaryBugDocs<span style="color: #002200;">]</span>;
RootViewController <span style="color: #002200;">*</span>rootController <span style="color: #002200;">=</span> <span style="color: #002200;">(</span>RootViewController <span style="color: #002200;">*</span><span style="color: #002200;">)</span> <span style="color: #002200;">[</span>navigationController.viewControllers objectAtIndex<span style="color: #002200;">:</span><span style="color: #2400d9;">0</span><span style="color: #002200;">]</span>;
rootController.bugs <span style="color: #002200;">=</span> loadedBugs;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>That handles loading of bugs. But we need to save bugs too! Make the following changes to EditBugViewController.m:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191414">
                    <td class="code" id="p1914code14"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In titleFieldValueChanged</span>
<span style="color: #002200;">[</span>_bugDoc saveData<span style="color: #002200;">]</span>;
&nbsp;
<span style="color: #11740a; font-style: italic;">// In rateView:ratingDidChange</span>
<span style="color: #002200;">[</span>_bugDoc saveData<span style="color: #002200;">]</span>;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>We go ahead and just save the doc immediately every time the title or rating changes. Since our data is so ridiculously small, this is fine for performance, but if you have a larger data set you might want to save periodically in the background instead,
        or when the user terminates the app or enters the background, etc.</p>
    <p>Lastly, make the following mod to RootViewController.m:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191415">
                    <td class="code" id="p1914code15"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In tableView:commitEditingStyle:forRowAtIndexPath, before removing the object from the bugs array:</span>
ScaryBugDoc <span style="color: #002200;">*</span>doc <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_bugs objectAtIndex<span style="color: #002200;">:</span>indexPath.row<span style="color: #002200;">]</span>;
<span style="color: #002200;">[</span>doc deleteDoc<span style="color: #002200;">]</span>;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>That’s it! Compile and run your app. When it starts up, you’ll see your table view with no bugs in it. However, that’s fine because no bugs are on disk yet. You can double check this by going to Run\Console, and scrolling to the bottom: it will print
        out where it’s looking for bug documents:</p>
    <pre class="command">Loading bugs from /Users/rwenderlich/Library/Application Support/
   iPhone Simulator/4.0.2/Applications/
   D13C7304-25FB-4EDC-B23D-62A084AD90B4/Library/Private Documents
</pre>
    <p>If you open up that directory in Finder, you’ll see it empty of course. So go ahead and create a bug in the app, and when you do you’ll see a new directory pop up in your Private Docs directory:</p>
    <p>
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/scarybugdoc" rel="attachment wp-att-1916" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc.jpg" alt="Scary Bug Document on Disk" title="Scary Bug Document on Disk" width="346" height="192" class="alignnone size-full wp-image-1916" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc.jpg 346w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc-150x83.jpg 150w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc-300x166.jpg 300w"
                sizes="(max-width: 346px) 100vw, 346px"></a>
    </p>
    <p>Also, you may find it interesting to double click on the data.plist file to see what that looks like as well:</p>
    <p>
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/scarybugplist" rel="attachment wp-att-1917" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugPlist.jpg" alt="Object Encoded with NSCoding and NSKeyedArchiver as a Property List" title="Object Encoded with NSCoding and NSKeyedArchiver as a Property List" width="660"
                height="230" class="alignnone size-full wp-image-1917" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugPlist.jpg 660w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugPlist-150x52.jpg 150w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugPlist-300x104.jpg 300w"
                sizes="(max-width: 660px) 100vw, 660px"></a>
    </p>
    <p>So as you can see since we’re using NSCoding + NSKeyedArchiver, our data is being saved out in a property list that is semi-human readable, which can be kind of nice for debugging sometimes.</p>
    <p>Now shut down Scary Bugs, and start it back up again. (Make sure you fully shut it down and restart, not just enter into the background!) When you do, you’ll see that it correctly loads the bug you created back in from disk, but you’ll notice that
        it didn’t save the image.</p>
    <p>
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/potatobugnopicture" rel="attachment wp-att-1920" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBugNoPicture.jpg" alt="Bug With No Picture" title="Bug With No Picture" width="319" height="91" class="alignnone size-full wp-image-1920 bordered" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBugNoPicture.jpg 319w, https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBugNoPicture-150x42.jpg 150w, https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBugNoPicture-300x85.jpg 300w"
                sizes="(max-width: 319px) 100vw, 319px"></a>
    </p>
    <p>That of course is because we didn’t save it! So let’s take care of that next.</p>
    <h2>Saving and Loading Images</h2>
    <p>Ok so we have this big image and thumbnail image that we need to save to disk. How should we do that?</p>
    <p>You may think that we should just encode it with NSCoding just like we did with the ScaryBugDoc data above. NSCoding does support this behavior (just convert it to NSData with UIImagePNGRepresentation and then use encodeObject:forKey, and then call
        decodeObjectForKey / UIImage initWithData on the other side), but it’s usually not the best way to go.</p>
    <p>This is because you usually don’t want to save huge pieces of data inside your main document if you can avoid it. </p>
    <p>Note how we load up all of the documents into a table view at startup, which access their data property and hence decodes the ScaryBugData from disk. If we included the images in this data, on startup it would load all of the big images into memory
        at once too. This would mean it would take longer for our app to start up, and we’d have a higher memory cost because we’d have to keep all of the images in memory at a time. </p>
    <p>But we don’t need to do that, because we don’t even look at the full images until we go into the detail view! So it would be a lot better if we just saved the images to disk, and only loaded them into memory as they were accessed, and relased them
        from memory when we weren’t using them anymore.</p>
    <p>So let’s do that and see what it looks like. Much like the way we saved the data of our ScaryBugDoc, we’re going to override the properties that get our images, and add a “saveImage” method as well.</p>
    <p>Make the following mod to ScaryBugDoc.h:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191416">
                    <td class="code" id="p1914code16"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// After @interface</span>
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>saveImages;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Then add the following to ScaryBugDoc.m:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191417">
                    <td class="code" id="p1914code17"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// Add to top of file</span>
<span style="color: #6e371a;">#define kThumbImageFile @"thumbImage.jpg"</span>
<span style="color: #6e371a;">#define kFullImageFile  @"fullImage.jpg"</span>
&nbsp;
<span style="color: #11740a; font-style: italic;">// Add new functions</span>
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span>UIImage <span style="color: #002200;">*</span><span style="color: #002200;">)</span>thumbImage <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_thumbImage <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span> _thumbImage;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>thumbImagePath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kThumbImageFile<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">return</span> <span style="color: #002200;">[</span>UIImage imageWithContentsOfFile<span style="color: #002200;">:</span>thumbImagePath<span style="color: #002200;">]</span>;
&nbsp;
<span style="color: #002200;">}</span>
&nbsp;
<span style="color: #002200;">-</span> <span style="color: #002200;">(</span>UIImage <span style="color: #002200;">*</span><span style="color: #002200;">)</span>fullImage <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_fullImage <span style="color: #002200;">!=</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span> _fullImage;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>fullImagePath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kFullImageFile<span style="color: #002200;">]</span>;
    <span style="color: #a61390;">return</span> <span style="color: #002200;">[</span>UIImage imageWithContentsOfFile<span style="color: #002200;">:</span>fullImagePath<span style="color: #002200;">]</span>;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Here we check to see if we have the images loaded into memory already, and if we do we return them. Otherwise, we just load the images straight off the disk with imageWithContentsOfFile.</p>
    <p>Note that we don’t cache the images in our instance variables. This is to avoid the situation where someone loads up the detail view for each of our images, and the images are still retained inside this class because they were loaded once, clogging
        up memory with images. However, the tradeoff is that images might have to be loaded from disk more often than necessary. If this gets to be problematic, one solution is to retain them in instance variables, but have a method to clear the cache
        that is called under low memory conditions.</p>
    <p>Then add the following as well:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191418">
                    <td class="code" id="p1914code18"><pre class="objc" style="font-family:monospace;"><span style="color: #002200;">-</span> <span style="color: #002200;">(</span><span style="color: #a61390;">void</span><span style="color: #002200;">)</span>saveImages <span style="color: #002200;">{</span>
&nbsp;
    <span style="color: #a61390;">if</span> <span style="color: #002200;">(</span>_thumbImage <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span> || _fullImage <span style="color: #002200;">==</span> <span style="color: #a61390;">nil</span><span style="color: #002200;">)</span> <span style="color: #a61390;">return</span>;
&nbsp;
    <span style="color: #002200;">[</span>self createDataPath<span style="color: #002200;">]</span>;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>thumbImagePath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kThumbImageFile<span style="color: #002200;">]</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/" sl-processed="1"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>thumbImageData <span style="color: #002200;">=</span> UIImagePNGRepresentation<span style="color: #002200;">(</span>_thumbImage<span style="color: #002200;">)</span>;
    <span style="color: #002200;">[</span>thumbImageData writeToFile<span style="color: #002200;">:</span>thumbImagePath atomically<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span><span style="color: #002200;">]</span>;
&nbsp;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/" sl-processed="1"><span style="color: #400080;">NSString</span></a> <span style="color: #002200;">*</span>fullImagePath <span style="color: #002200;">=</span> <span style="color: #002200;">[</span>_docPath stringByAppendingPathComponent<span style="color: #002200;">:</span>kFullImageFile<span style="color: #002200;">]</span>;
    <a href="https://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSData_Class/" sl-processed="1"><span style="color: #400080;">NSData</span></a> <span style="color: #002200;">*</span>fullImageData <span style="color: #002200;">=</span> UIImagePNGRepresentation<span style="color: #002200;">(</span>_fullImage<span style="color: #002200;">)</span>;
    <span style="color: #002200;">[</span>fullImageData writeToFile<span style="color: #002200;">:</span>fullImagePath atomically<span style="color: #002200;">:</span><span style="color: #a61390;">YES</span><span style="color: #002200;">]</span>;
&nbsp;
    self.thumbImage <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;
    self.fullImage <span style="color: #002200;">=</span> <span style="color: #a61390;">nil</span>;
&nbsp;
<span style="color: #002200;">}</span></pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>Here we just write both images out to disk and set our cached copies back to nil (for the same reasons discussed above).</p>
    <p>Now we just need to call the code to save the images at the right spot. Modify EditBugViewController.m to make the following change:</p>

    <div class="wp_codebox">
        <table>
            <tbody>
                <tr id="p191419">
                    <td class="code" id="p1914code19"><pre class="objc" style="font-family:monospace;"><span style="color: #11740a; font-style: italic;">// In imagePickerController:didFinishPickingMediaWithInfo, after _imageView.image = fullImage:</span>
<span style="color: #002200;">[</span>_bugDoc saveImages<span style="color: #002200;">]</span>;</pre></td>
                </tr>
            </tbody>
        </table>
    </div>

    <p>That’s it! Complie and run your app, and change the picture for a bug. Afterwards you’ll see your document directory contains the images:</p>
    <p>
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/scarybugdoc2" rel="attachment wp-att-1918" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc2.jpg" alt="Scary Bug Document with Images" title="Scary Bug Document with Images" width="344" height="227" class="alignnone size-full wp-image-1918" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc2.jpg 344w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc2-150x98.jpg 150w, https://koenig-media.raywenderlich.com/uploads/2010/08/ScaryBugDoc2-300x197.jpg 300w"
                sizes="(max-width: 344px) 100vw, 344px"></a>
    </p>
    <p>And now if you shut down and restart your app, you’ll see that the images have been persisted as well!</p>
    <p>
        <a href="https://www.raywenderlich.com/1914/how-to-save-your-app-data-with-nscoding-and-nsfilemanager/potatobug" rel="attachment wp-att-1919" sl-processed="1"><img src="https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBug.jpg" alt="Our Bug Saved To Disk!" title="Our Bug Saved To Disk!" width="318" height="411" class="alignnone size-full wp-image-1919 bordered" srcset="https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBug.jpg 318w, https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBug-116x150.jpg 116w, https://koenig-media.raywenderlich.com/uploads/2010/08/PotatoBug-232x300.jpg 232w"
                sizes="(max-width: 318px) 100vw, 318px"></a>
    </p>

</div>
